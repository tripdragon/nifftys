var F=Object.defineProperty;var H=(t,e,o)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var r=(t,e,o)=>H(t,typeof e!="symbol"?e+"":e,o);import{P as A,V as f,a as M,G as x,i as L,s as R,A as a,b as O,c as S,d as T,e as C,f as z,g as B,h as k,j as D,o as u,B as G,M as I,k as U,l as V,m as W,C as w,S as E,n as _,p as q,q as X,r as N}from"./setupTouchEvents-2BQBLUkL.js";function K(t){const e=new A(new f(0,1,0),0),o=new M(e,.2,16776960);t.scene.add(o),t.debugPlane=e,t.debugPlaneHelper=o,t.debugPlaneHelper.visible=t.debugSettings.showWorldPlane}function J({store:t,type:e}){if(e==="y"){const s=new x(2,10,void 0,16711680);t.scene.add(s),t.grids.y=s}if(e==="x"){const s=new x(2,10,void 0,65280);t.scene.add(s),t.grids.x=s,s.rotation.x=Math.PI/2}if(e==="z"){const s=new x(2,10,void 0,255);t.scene.add(s),t.grids.z=s,s.rotation.z=Math.PI/2}}function Q(){L(a),R(a),O(a),S(a),T(a),C(a,{win:function(){z(a),B(a),k(a),D(a),a.xr.onStartButton=function(){a.orbitControls.enabled=!1,a.xr.currentModel&&(a.xr.currentModel.visible=!1),a.debugPlaneHelper&&(a.debugPlaneHelper.visible=!1),a.grids.toggle(!1);const l=document.getElementById("OnScreenLoggerlogger"),h=document.getElementById("ar-overlay");l&&h&&h.appendChild(l)},u("setupXR good")},fail:function(){const l=document.getElementById("launch-button");l&&(l.onclick=function(){console.log("does nothing"),u("no XR")})}}),K(a),J({store:a,type:"y"}),a.grids.toggle(!0);const t=a.scene,e=a.camera;a.renderer;const o=new G,n=new I({color:4500104}),s=new U(o,n);s.scale.setScalar(.5),s.visible=!1;const c=new V(16777215,2,100);c.position.set(5,5,5),t.add(c),W(a.scene),e.position.z=.5}const d=new f,g=new f;new f;class Y{constructor({wobj:e,force:o,angularForce:n,type:s}){r(this,"selected",null);r(this,"type","fish");r(this,"force",null);r(this,"angularForce",null);r(this,"loopId",0);r(this,"forceWork",new f);r(this,"angularForceWork",new f);r(this,"stopRequested",!1);r(this,"otherdata",{});r(this,"startFunx",null);r(this,"midFunx",null);r(this,"doneFunx",null);this.selected=e,this.force=o,this.angularForce=n,this.type=s}decoStartFunx(e){this.startFunx=e.bind(this)}decoMidFunx(e){this.midFunx=e.bind(this)}decoDoneFunx(e){this.doneFunx=e.bind(this)}setForceAnchor(e){this.force.anchor.copy(e)}start(){this.stopRequested=!1,this.type==="impulse"?(y(this.selected,this.force.vecForce,this.force.damping),this.selected.physics.clearAcceleration()):this.type,console.log(this.selected.position),P(this.selected,this.angularForce.vecForce,this.angularForce.damping),this.selected.physics.clearAngularAcceleration(),this.startFunx&&this.startFunx();const e=this;this.loopR=function(){if(e.stopRequested===!0){e.stop();return}e.type==="spring"?j(e.selected,e.force,e.forceWork,e.force.damping):e.type==="impulse"&&y(e.selected,e.forceWork,e.force.damping),P(e.selected,e.angularForceWork,e.angularForce.damping),e.midFunx&&e.midFunx.call(e),e.selected.physics.clearAcceleration(),e.selected.physics.clearAngularAcceleration(),Math.abs(e.selected.physics.velocity.length()&&e.selected.physics.angularVelocity.length())>=1e-4?e.loopId=requestAnimationFrame(e.loopR):(e.doneFunx&&e.doneFunx.call(e),console.log("done??¿¿?¿"))},e.loopR()}stop(){this.stopRequested=!0,cancelAnimationFrame(this.loopId)}}class Z{constructor({vecForce:e,damping:o,coefriction:n}){r(this,"vecForce",new f);r(this,"damping",1);r(this,"coefriction",1);this.vecForce.copy(e),this.damping=o,this.coefriction=n}}class ${constructor({anchor:e,restLength:o,constantK:n,damping:s}){r(this,"anchor",new f);r(this,"restLength",0);r(this,"k",0);r(this,"damping",1);this.anchor.copy(e),this.restLength=o,this.k=n,this.damping=s}}function P(t,e,o=1){g.copy(e),g.divideScalar(t.physics.mass),t.physics.angularAcceleration.add(g),t.physics.angularVelocity.add(t.physics.angularAcceleration),t.physics.angularVelocity.multiplyScalar(o),t.rotation.x+=t.physics.angularVelocity.x,t.rotation.y+=t.physics.angularVelocity.y,t.rotation.z+=t.physics.angularVelocity.z}function y(t,e,o=1){d.copy(e),d.divideScalar(t.physics.mass),t.physics.acceleration.add(d),t.physics.velocity.add(t.physics.acceleration),t.physics.velocity.multiplyScalar(o),t.position.add(t.physics.velocity)}function j(t,e,o,n=1){d.copy(t.position),d.sub(e.anchor);var s=d.length(),c=s-e.restLength;d.normalize();var l=-1*e.k*c;d.multiplyScalar(l),y(t,d,n)}class i{constructor({store:e,name:o="",color:n,colorHex:s,emissive:c,emissiveHex:l,roughness:h=0,metalness:p=.5,map:v=null,renderOrder:b=0}){r(this,"color",new w(1,1,1));r(this,"emissive",new w(0,0,0));r(this,"store",null);this.name=o,n&&this.color.copy(n),s&&this.color.setHex(s),this.roughness=h,this.metalness=p,c&&this.emissive.copy(c),l&&this.emissive.setHex(l),this.map=v,this.renderOrder=b,this.store=e}copyMaterial(e){this.name=e.name,this.color.copy(e.color),this.roughness=e.roughness||0,this.metalness=e.metalness||0,this.emissive.copy(e.emissive),e.map&&(this.store.registerTexture(e.map),this.map=e.map)}applyToMaterial(e){e.color.copy(this.color),e.emissive.copy(this.emissive),e.roughness=this.roughness,e.metalness=this.metalness,e.renderOrder=this.renderOrder,e.map=this.map,e.parentPointer&&(e.parentPointer.renderOrder=this.renderOrder,console.log("this.renderOrder",this.renderOrder)),console.log("// just mashing this in here for now cause its pretty"),e.metalness=.5,e.roughness=.04}}class ee extends E{constructor(o){super();r(this,"isModelLoaded",!0);r(this,"isRoot",!0);r(this,"selectorMesh",null);r(this,"modelUrl","");r(this,"animations",null);r(this,"mixer",null);this.modelUrl=o}async init(o){const s=await new _().loadAsync(this.modelUrl);this.wrap(s,o),this.animations=s.animations,this.mixer=new q(s.scene),this.update=function(c){this.updateAnimations(c)}}wrap(o,n){let s=o.scene;X(s),this.add(s),this.selectorMesh=s.getObjectByName("selector_mesh")||null,this.selectorMesh&&(this.selectorMesh.rootObject=this,n&&n.raycastingGraph.add(this.selectorMesh))}playAnimations(){this.mixer&&this.animations&&(this.mixer.stopAllAction(),this.animations.forEach(o=>{try{const n=this.mixer.clipAction(o);n&&n.reset&&n.play&&(n.reset(),n.play())}catch{}}))}updateAnimations(o){this.mixer&&this.mixer.update(o)}}class m{constructor({name:e,image:o,color:n,ref:s,restPosition:c,theme:l,type:h,fullColor:p}){r(this,"restPosition",new f);this.name=e||"navaitem",this.image=o||null,this.color=n||16777215,this.ref=s||null,this.fullColor=p||255,this.type=h||"fullTheme",c&&this.restPosition.copy(c),this.theme=l||null}}new f,new m({name:"blue",image:"narf111.png",color:11206434,theme:[{name:"tounge",matProxy:new i({colorHex:255})},{name:"rivits",matProxy:new i({colorHex:16777215,metalness:1,roughness:0})},{name:"logo",matProxy:new i({colorHex:16777215,texture:null})},{name:"laces",matProxy:new i({colorHex:16776960,texture:null})},{name:"under cloth",matProxy:new i({colorHex:16711935})},{name:"over cloth",matProxy:new i({colorHex:16711935,visible:!0,renderOrder:-1})},{name:"rubber",matProxy:new i({colorHex:0})},{name:"bottom sole",matProxy:new i({colorHex:35791394,texture:"bottom1"})},{name:"inner soles",matProxy:new i({colorHex:1118481})},{name:"front tip",matProxy:new i({colorHex:16777215})}]}),new m({name:"pats",image:"narf111.png",color:11206434,theme:[{name:"tounge",matProxy:new i({colorHex:0})},{name:"rivits",matProxy:new i({colorHex:16777215,metalness:1,roughness:0})},{name:"logo",matProxy:new i({colorHex:16777215,texture:null})},{name:"laces",matProxy:new i({colorHex:16711680,texture:null})},{name:"under cloth",matProxy:new i({colorHex:255})},{name:"over cloth",matProxy:new i({colorHex:255,visible:!0,renderOrder:-1})},{name:"rubber",matProxy:new i({colorHex:16777215})},{name:"bottom sole",matProxy:new i({colorHex:1118481,texture:"bottom1"})},{name:"inner soles",matProxy:new i({colorHex:5592490})},{name:"front tip",matProxy:new i({colorHex:0})}]}),new m({name:"yellow",image:"narf222.png",color:3385890,type:"fullColor",fullColor:65518}),new m({name:"redish",image:"narf111.png",color:11206434,theme:[{name:"tounge",matProxy:new i({colorHex:16777215})},{name:"rivits",matProxy:new i({colorHex:16777215,metalness:1,roughness:0})},{name:"logo",matProxy:new i({colorHex:0,texture:null})},{name:"laces",matProxy:new i({colorHex:16711680,texture:null})},{name:"under cloth",matProxy:new i({colorHex:16711680})},{name:"over cloth",matProxy:new i({colorHex:16711680,visible:!0,renderOrder:-1})},{name:"rubber",matProxy:new i({colorHex:16777215})},{name:"bottom sole",matProxy:new i({colorHex:1118481,texture:"bottom1"})},{name:"inner soles",matProxy:new i({colorHex:5592490})},{name:"front tip",matProxy:new i({colorHex:0})}]});new URL("/nifftys/assets/shoe02withselectormesh-DeNTug6p.glb",import.meta.url).href;const te=new URL("/nifftys/assets/gift_box5-BDGDLnUt.glb",import.meta.url).href;async function oe(t){const e=new ee(te);return await e.init(t),e.scale.setScalar(.08),e.children[0].position.y+=1,t.scene.add(e),t.sceneGrapth.add(e),e.selectorMesh&&(e.selectorMesh.visible=!1),e.name="giftbox",e.onTap=(function(){console.log("Do the on tap"),this.randomColor()}).bind(e),e.selectorMesh&&(e.selectorMesh.onTap=(function(){console.log("not a tap yet"),this.rootObject.onTap()}).bind(e.selectorMesh)),e.onAppear=function(){e.playAnimations()},e.physics.builder=()=>{const o=e.position.clone();e.position.y-=.1;const n=new Y({wobj:e,force:new $({anchor:o.add(new f(0,.1,0)),restLength:.1,constantK:.014,damping:.91}),angularForce:new Z({vecForce:new f(0,.6,0),damping:.9281,coefriction:1}),type:"spring"});n.decoStartFunx(function(){this.selected.visible=!0,this.selected.setOpacity(0),this.otherdata.matOpacity=0,this.otherdata.fadeInRate=.02}),n.decoMidFunx(function(){this.otherdata.matOpacity+=this.otherdata.fadeInRate,this.selected.setOpacity(this.otherdata.matOpacity)}),e.physics.session=n},e}async function se(){console.log("NARF"),await Q(),N.enabled=!0;const t=[new URL("/nifftys/assets/gift_box5-BDGDLnUt.glb",import.meta.url).href,new URL("/nifftys/assets/shoe02withselectormesh-DeNTug6p.glb",import.meta.url).href],e=[];try{const o=document.getElementById("tracking-prompt");o.innerText="loading";const[n,s]=await Promise.all([a.loaders.loadGLBs(t),a.loaders.loadTextures(e)]);console.log("model loaded!!"),o.innerText="model loaded";try{if(a.loaders.modelsUrlCache[t[0]]){const l=await oe(a);a.xr.currentModel=l,o.innerText="ready",u("main ready"),l.onAppear(),l.physics.replay()}}catch(c){console.log("model missing",c),o.innerText="error ??!?!?!",u("model missing")}console.log("fish!!")}catch(o){console.error("Error loading assets:",o)}}se();
